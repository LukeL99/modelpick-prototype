---
phase: 01-configure-benchmark
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/app/auth/login/page.tsx
  - src/app/auth/signup/page.tsx
  - src/app/auth/callback/route.ts
  - src/app/auth/confirm/route.ts
  - src/app/(app)/layout.tsx
  - src/app/(app)/dashboard/page.tsx
  - src/components/auth/login-form.tsx
  - src/components/auth/signup-form.tsx
  - src/components/auth/social-buttons.tsx
  - src/components/dashboard/report-list.tsx
  - src/components/dashboard/report-card.tsx
  - src/components/dashboard/empty-state.tsx
  - src/components/ui/button.tsx
  - src/components/ui/card.tsx
autonomous: true

must_haves:
  truths:
    - "User can create an account with email/password and is redirected to dashboard"
    - "User can sign in with Google OAuth and is redirected to dashboard"
    - "User can sign in with GitHub OAuth and is redirected to dashboard"
    - "User can request a magic link via email"
    - "User session persists across browser refresh (middleware refreshes token)"
    - "Authenticated user sees dashboard with empty state and CTA to run first benchmark"
    - "Unauthenticated user visiting /dashboard is redirected to /auth/login"
  artifacts:
    - path: "src/app/auth/callback/route.ts"
      provides: "OAuth + magic link PKCE exchange"
      exports: ["GET"]
    - path: "src/app/(app)/dashboard/page.tsx"
      provides: "Dashboard page with report list or empty state"
      min_lines: 20
    - path: "src/components/auth/login-form.tsx"
      provides: "Login form with email/password and magic link toggle"
      min_lines: 40
    - path: "src/components/auth/signup-form.tsx"
      provides: "Signup form with email confirmation"
      min_lines: 30
    - path: "src/components/auth/social-buttons.tsx"
      provides: "Google and GitHub OAuth buttons"
      min_lines: 20
    - path: "src/components/dashboard/empty-state.tsx"
      provides: "Empty state CTA for new users"
      min_lines: 15
    - path: "src/app/(app)/layout.tsx"
      provides: "Authenticated app layout with nav and auth guard"
      min_lines: 20
    - path: "src/components/ui/button.tsx"
      provides: "Reusable button with primary/secondary/ghost variants"
      min_lines: 20
  key_links:
    - from: "src/app/auth/callback/route.ts"
      to: "@supabase/ssr"
      via: "exchangeCodeForSession"
      pattern: "exchangeCodeForSession"
    - from: "src/app/(app)/layout.tsx"
      to: "src/lib/supabase/server.ts"
      via: "Server client getUser check"
      pattern: "getUser"
    - from: "src/components/auth/login-form.tsx"
      to: "src/app/(app)/dashboard/page.tsx"
      via: "router.push on successful login"
      pattern: "router.push.*dashboard"
    - from: "src/components/auth/social-buttons.tsx"
      to: "src/lib/supabase/client.ts"
      via: "signInWithOAuth call"
      pattern: "signInWithOAuth"
---

<objective>
Build the authentication UI (login, signup, social OAuth, magic link, callback routes) and the authenticated dashboard with empty state for new users and chronological report list for returning users.

Purpose: Deliver the complete auth experience and the dashboard as the primary logged-in experience. Users can create accounts, sign in via multiple methods, and land on a dashboard that surfaces their benchmark reports.
Output: Working auth flow (email/password, Google, GitHub, magic link) with protected dashboard route showing empty state or report list.
</objective>

<execution_context>
@/Users/lukelibraro/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lukelibraro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-configure-benchmark/01-RESEARCH.md
@.planning/phases/01-configure-benchmark/01-CONTEXT.md
@.planning/phases/01-configure-benchmark/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Shared UI components, auth pages with login/signup forms, social buttons, and callback routes</name>
  <files>
    src/components/ui/button.tsx
    src/components/ui/card.tsx
    src/components/auth/login-form.tsx
    src/components/auth/signup-form.tsx
    src/components/auth/social-buttons.tsx
    src/app/auth/login/page.tsx
    src/app/auth/signup/page.tsx
    src/app/auth/callback/route.ts
    src/app/auth/confirm/route.ts
  </files>
  <action>
    **Build the authentication UI and callback routes. Follow the dark-warm palette (void background, ember accents, Inter font).**

    1. **Create shared UI components:**
       - `src/components/ui/button.tsx`: Reusable button with variants: `primary` (bg-ember text-white hover:bg-ember-hover), `secondary` (bg-surface-raised border-surface-border), `ghost` (transparent hover:bg-surface-raised). Sizes: `sm`, `md`, `lg`. Accept standard button props.
       - `src/components/ui/card.tsx`: Reusable card with `bg-surface border border-surface-border rounded-xl` base style. Accept className for composition.

    2. **Create social login buttons** (`src/components/auth/social-buttons.tsx`):
       - "use client" component
       - "Continue with Google" and "Continue with GitHub" buttons
       - Each calls `supabase.auth.signInWithOAuth({ provider, options: { redirectTo: \`${window.location.origin}/auth/callback\` } })`
       - Use the browser Supabase client from `src/lib/supabase/client.ts`
       - Show loading state while redirecting
       - Style: full-width buttons with provider icons (use lucide-react or inline SVGs for Google/GitHub logos)

    3. **Create login form** (`src/components/auth/login-form.tsx`):
       - "use client" component
       - Two modes: email/password login, and magic link
       - Email input + password input + "Sign In" button for email/password mode
       - "Send Magic Link" button that calls `supabase.auth.signInWithOtp({ email, options: { emailRedirectTo } })`
       - Toggle between modes: "Use magic link instead" / "Use password instead"
       - Show success message after magic link sent: "Check your email for a sign-in link"
       - Show error messages inline (e.g., "Invalid login credentials")
       - On successful email/password login, redirect to `/dashboard` using `router.push`
       - Link to signup: "Don't have an account? Sign up"

    4. **Create signup form** (`src/components/auth/signup-form.tsx`):
       - "use client" component
       - Email + password + confirm password fields
       - Call `supabase.auth.signUp({ email, password, options: { emailRedirectTo: \`${origin}/auth/callback\` } })`
       - Show confirmation message: "Check your email to confirm your account"
       - Show inline validation: password min 8 chars, passwords match
       - Link to login: "Already have an account? Sign in"

    5. **Create auth pages:**
       - `src/app/auth/login/page.tsx`: Server component that renders login-form + social-buttons. Centered card layout on void background. ModelPick wordmark at top.
       - `src/app/auth/signup/page.tsx`: Same layout with signup-form + social-buttons.
       - Both pages: Check if user is already authenticated via server client `getUser()`. If authenticated, redirect to `/dashboard`.

    6. **Create auth callback routes** (follow RESEARCH.md patterns EXACTLY):
       - `src/app/auth/callback/route.ts`: GET handler that exchanges `code` search param for session via `exchangeCodeForSession`. On success, redirect to `/dashboard` (or `next` param). On error, redirect to `/auth/login?error=auth_callback_failed`.
       - `src/app/auth/confirm/route.ts`: GET handler for email confirmation. Same PKCE exchange pattern. Redirect to `/dashboard` on success.

    **Design guidelines (Claude's discretion):**
    - Auth pages: Centered card (max-w-md) on void background, ModelPick wordmark above
    - Social buttons above the divider ("or"), then email/password form below
    - Inputs: bg-surface-raised border-surface-border rounded-lg, focus ring in ember
    - Error messages: text-red-400, shown inline below the relevant input
    - Loading states: Button shows spinner (Loader2 from lucide-react) and disables during async ops
    - Mobile: Stack layout works naturally with max-w-md centering

    **Anti-patterns to AVOID:**
    - Do NOT use `getSession()` in server components -- use `getUser()`
    - Do NOT skip the `try/catch` in server.ts `setAll` -- it is needed for Server Component read-only cookie context
    - Do NOT hardcode redirect URLs -- use `window.location.origin` or env var
  </action>
  <verify>
    1. `npm run build` succeeds
    2. Visiting `/auth/login` shows the login form with social buttons, email/password fields, and magic link option
    3. Visiting `/auth/signup` shows the signup form with social buttons
    4. TypeScript compiles with no errors in all auth components
  </verify>
  <done>
    Auth UI complete: login page with email/password, social (Google/GitHub), and magic link. Signup page with email confirmation flow. OAuth callback route handles PKCE exchange. Shared button and card components available for reuse.
  </done>
</task>

<task type="auto">
  <name>Task 2: Authenticated app layout and dashboard with empty state and report list</name>
  <files>
    src/app/(app)/layout.tsx
    src/app/(app)/dashboard/page.tsx
    src/components/dashboard/report-list.tsx
    src/components/dashboard/report-card.tsx
    src/components/dashboard/empty-state.tsx
  </files>
  <action>
    **Build the authenticated app shell and dashboard page. Dashboard is the primary logged-in experience per user decision.**

    1. **Create authenticated app layout** (`src/app/(app)/layout.tsx`):
       - Server component
       - Check auth via `getUser()` -- if no user, redirect to `/auth/login`
       - Simple top nav bar: ModelPick logo (links to /dashboard), user email display, "New Benchmark" button (links to /benchmark/new), "Sign Out" button
       - Sign out: Create a client component for the sign-out button that calls `supabase.auth.signOut()` and redirects to `/`
       - Body area renders `{children}`

    2. **Create dashboard page** (`src/app/(app)/dashboard/page.tsx`):
       - Server component that fetches user's reports from Supabase: `supabase.from('reports').select('*').eq('user_id', user.id).order('created_at', { ascending: false })`
       - If no reports: render `<EmptyState />`
       - If reports exist: render `<ReportList reports={reports} />`

    3. **Create dashboard components:**
       - `src/components/dashboard/empty-state.tsx`: Big centered CTA. Headline: "Run your first benchmark". Subtext: "Upload sample images, tell us what to extract, and we'll test 20+ vision models to find the best one for your use case." Big ember-colored button: "Start Benchmark" linking to `/benchmark/new`. Below: "See an example report" link (placeholder href for now -- links to # or a future example report).
       - `src/components/dashboard/report-card.tsx`: Card component showing report summary. Props: report object. Display: date (formatted), top model name, accuracy %, cost, number of models tested, status badge. Link to `/report/{id}` (non-functional in Phase 1 but structured correctly).
       - `src/components/dashboard/report-list.tsx`: Renders array of ReportCard components in a vertical list. Heading: "Your Reports" with count. Per user decision: simple chronological list, newest first, no search/filter/tags.

    **Design guidelines (Claude's discretion):**
    - Dashboard: max-w-4xl centered, padding for breathing room
    - Empty state: centered vertically and horizontally, large icon above headline
    - Report cards: use Card component from ui/card.tsx, hover state with slightly raised border
    - Nav bar: bg-surface with bottom border, sticky top

    **Anti-patterns to AVOID:**
    - Do NOT use `getSession()` in server components -- use `getUser()`
    - Do NOT add search/filter/tags to report list -- per user decision, simple chronological list for v1
  </action>
  <verify>
    1. `npm run build` succeeds
    2. Visiting `/dashboard` without auth redirects to `/auth/login`
    3. The empty state component renders with "Run your first benchmark" CTA
    4. TypeScript compiles with no errors in all dashboard components
  </verify>
  <done>
    Authenticated app layout protects all /(app) routes with getUser() check. Dashboard page shows empty state for new users with CTA to start first benchmark. Report list component ready for returning users with chronological card view. Nav bar shows user email, "New Benchmark" button, and sign-out.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes with zero errors
2. `/auth/login` renders login form with all auth methods (email/password, social, magic link)
3. `/auth/signup` renders signup form with social buttons
4. `/dashboard` redirects to login when not authenticated
5. Dashboard shows empty state for new users
6. After Supabase is configured by user: full auth flow works (signup -> confirm email -> login -> dashboard)
</verification>

<success_criteria>
- Auth supports email/password, Google OAuth, GitHub OAuth, and magic link
- Auth callback routes handle PKCE exchange for OAuth and email confirmation
- Dashboard shows empty state with CTA for new users and chronological report list for returning users
- All protected routes redirect to login when unauthenticated
- Session persists across refresh via middleware (from Plan 01-01)
- Shared UI components (button, card) available for reuse
</success_criteria>

<output>
After completion, create `.planning/phases/01-configure-benchmark/01-02-SUMMARY.md`
</output>
