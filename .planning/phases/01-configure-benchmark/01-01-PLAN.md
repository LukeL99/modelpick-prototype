---
phase: 01-configure-benchmark
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - next.config.ts
  - tailwind.css
  - .env.local.example
  - src/app/layout.tsx
  - src/app/(marketing)/layout.tsx
  - src/app/(marketing)/page.tsx
  - src/lib/supabase/client.ts
  - src/lib/supabase/server.ts
  - src/lib/supabase/middleware.ts
  - src/middleware.ts
  - src/types/database.ts
  - src/types/wizard.ts
  - src/types/benchmark.ts
  - src/lib/config/models.ts
  - src/lib/config/constants.ts
  - supabase/migrations/001_initial_schema.sql
autonomous: true
user_setup:
  - service: supabase
    why: "Auth + Database + Storage backend"
    env_vars:
      - name: NEXT_PUBLIC_SUPABASE_URL
        source: "Supabase Dashboard -> Project Settings -> API -> Project URL"
      - name: NEXT_PUBLIC_SUPABASE_ANON_KEY
        source: "Supabase Dashboard -> Project Settings -> API -> anon/public key"
    dashboard_config:
      - task: "Create Supabase project"
        location: "https://supabase.com/dashboard -> New project"
      - task: "Enable Google OAuth provider"
        location: "Supabase Dashboard -> Auth -> Providers -> Google (requires Google Cloud Console OAuth credentials)"
      - task: "Enable GitHub OAuth provider"
        location: "Supabase Dashboard -> Auth -> Providers -> GitHub (requires GitHub OAuth App)"
      - task: "Add redirect URLs"
        location: "Supabase Dashboard -> Auth -> URL Configuration -> Redirect URLs: add http://localhost:3000/auth/callback"
      - task: "Create benchmark-images storage bucket"
        location: "Supabase Dashboard -> Storage -> New bucket -> name: benchmark-images, private"
      - task: "Run database migration"
        location: "Copy supabase/migrations/001_initial_schema.sql and run in Supabase Dashboard -> SQL Editor"

must_haves:
  truths:
    - "Next.js 16 project builds and runs with Tailwind CSS v4 dark-warm palette"
    - "Supabase browser client, server client, and middleware client are properly configured"
    - "Middleware refreshes auth session and protects /(app) routes"
    - "Database migration creates benchmark_drafts and reports tables with RLS"
    - "Type definitions compile for wizard state, benchmark config, and database schema"
    - "Root route (/) shows a landing page with sign-in CTA"
  artifacts:
    - path: "src/middleware.ts"
      provides: "Auth session refresh on every request"
      contains: "updateSession"
    - path: "src/lib/supabase/client.ts"
      provides: "Browser Supabase client"
      exports: ["createClient"]
    - path: "src/lib/supabase/server.ts"
      provides: "Server Supabase client"
      exports: ["createClient"]
    - path: "src/lib/supabase/middleware.ts"
      provides: "Middleware Supabase client with session refresh and route protection"
      exports: ["updateSession"]
    - path: "supabase/migrations/001_initial_schema.sql"
      provides: "Database schema for drafts and reports"
      contains: "benchmark_drafts"
    - path: "src/types/wizard.ts"
      provides: "Type definitions for wizard state"
      contains: "WizardConfig"
    - path: "src/types/database.ts"
      provides: "TypeScript types matching DB schema"
      contains: "BenchmarkDraft"
    - path: "src/lib/config/models.ts"
      provides: "Curated vision model list with pricing"
      contains: "ModelInfo"
    - path: "src/lib/config/constants.ts"
      provides: "Application constants"
      contains: "MAX_IMAGES"
  key_links:
    - from: "src/middleware.ts"
      to: "src/lib/supabase/middleware.ts"
      via: "updateSession import"
      pattern: "import.*updateSession.*middleware"
    - from: "src/app/layout.tsx"
      to: "next/font/google"
      via: "Inter and JetBrains Mono font imports"
      pattern: "import.*Inter|JetBrains"
---

<objective>
Set up the Next.js 16 project from scratch with Supabase clients, middleware-based session refresh, database migration, type definitions, config files, Tailwind CSS v4 dark-warm palette, and a placeholder landing page.

Purpose: Establish the project foundation that all subsequent plans build on -- the framework, Supabase infrastructure, database schema, type system, and configuration.
Output: Working Next.js app with Supabase clients, middleware, database migration, type definitions, config files, and a landing page at the root route.
</objective>

<execution_context>
@/Users/lukelibraro/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lukelibraro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-configure-benchmark/01-RESEARCH.md
@.planning/phases/01-configure-benchmark/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Next.js project, install dependencies, configure Tailwind v4, and create Supabase clients with middleware</name>
  <files>
    package.json
    next.config.ts
    tailwind.css
    .env.local.example
    src/app/layout.tsx
    src/app/(marketing)/layout.tsx
    src/app/(marketing)/page.tsx
    src/lib/supabase/client.ts
    src/lib/supabase/server.ts
    src/lib/supabase/middleware.ts
    src/middleware.ts
  </files>
  <action>
    **IMPORTANT: This is a FRESH Next.js build. The existing Vite/React prototype in this repo is reference only. Create the Next.js app in a NEW directory structure (`src/app/` App Router) alongside the existing `src/` prototype code. The prototype files will be cleaned up later.**

    1. **Initialize Next.js 16 project:**
       Run `npx create-next-app@latest . --typescript --tailwind --app --src-dir --turbopack` in a temporary directory, then copy the generated scaffold files into the repo root, OVERWRITING existing Vite config files (vite.config.ts, etc.) but preserving `.planning/` and `.git/`. The key files needed: `next.config.ts`, `postcss.config.mjs`, `tsconfig.json`, `package.json` (merge dependencies). Remove Vite-specific files: `vite.config.ts`, `index.html`, `src/main.tsx`, `src/App.tsx`.

    2. **Install all Phase 1 dependencies:**
       ```
       npm install @supabase/supabase-js @supabase/ssr zod nanoid lucide-react
       npm install @dnd-kit/react @dnd-kit/helpers react-dropzone @uiw/react-codemirror @codemirror/lang-json @uiw/codemirror-theme-vscode @jsonhero/schema-infer nuqs
       ```
       Remove old Vite/React Router dependencies: `react-router-dom`, `@vitejs/plugin-react`, `@tailwindcss/vite`, `recharts`, `vite`.

    3. **Configure Tailwind CSS v4 with dark-warm palette:**
       Create `src/app/globals.css` (or `tailwind.css` at root) with Tailwind v4 `@import "tailwindcss"` and `@theme` block defining the design system colors:
       - `--color-void: #0A0A0B` (background)
       - `--color-surface: #141415` (card background)
       - `--color-surface-raised: #1E1E20` (elevated surfaces)
       - `--color-surface-border: #2A2A2D` (borders)
       - `--color-ember: #F97316` (primary/orange)
       - `--color-ember-hover: #EA580C` (primary hover)
       - `--color-text-primary: #F5F5F5` (main text)
       - `--color-text-secondary: #A3A3A8` (secondary text)
       - `--color-text-muted: #6B6B70` (muted text)
       Font families: Inter for body, JetBrains Mono for code. Import via `next/font/google` in root layout.

    4. **Create root layout** (`src/app/layout.tsx`):
       - Import Inter and JetBrains Mono from `next/font/google`
       - Apply dark background (`bg-void text-text-primary`) to body
       - Set metadata: title "ModelPick", description about vision model benchmarking
       - Wrap children with `<NuqsAdapter>` from `nuqs/adapters/next/app` for URL state

    5. **Create marketing layout** (`src/app/(marketing)/layout.tsx`):
       - Simple layout with no auth check (public routes)
       - Minimal header with ModelPick logo/wordmark and "Sign In" link

    6. **Create placeholder landing page** (`src/app/(marketing)/page.tsx`):
       - Simple hero section: "Find the best vision model for your data" headline
       - CTA button linking to `/auth/signup`
       - Minimal -- will be fleshed out later. Just enough to have a working root route.

    7. **Create Supabase client helpers** (follow RESEARCH.md patterns EXACTLY):
       - `src/lib/supabase/client.ts`: `createClient()` using `createBrowserClient` from `@supabase/ssr`
       - `src/lib/supabase/server.ts`: async `createClient()` using `createServerClient` from `@supabase/ssr` with `cookies()` from `next/headers`
       - `src/lib/supabase/middleware.ts`: `updateSession()` function that creates server client, calls `getUser()` for token refresh, redirects unauthenticated users on `/(app)` routes to `/auth/login`

    8. **Create Next.js middleware** (`src/middleware.ts`):
       - Import and call `updateSession` from `src/lib/supabase/middleware`
       - Matcher config: exclude `_next/static`, `_next/image`, favicon, and image files

    9. **Create `.env.local.example`:**
       ```
       NEXT_PUBLIC_SUPABASE_URL=your-project-url
       NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
       NEXT_PUBLIC_SITE_URL=http://localhost:3000
       ```

    **Anti-patterns to AVOID:**
    - Do NOT use `getSession()` in server code -- always `getUser()`
    - Do NOT use `@supabase/auth-helpers-nextjs` -- it is deprecated, use `@supabase/ssr`
    - Do NOT hardcode localhost in OAuth redirect URLs -- use `process.env.NEXT_PUBLIC_SITE_URL` or `window.location.origin`
  </action>
  <verify>
    1. `npm run build` succeeds with no TypeScript errors
    2. `npm run dev` starts the dev server and visiting http://localhost:3000 shows the landing page
    3. TypeScript compiles with no errors across all created files
  </verify>
  <done>
    Next.js 16 project builds and runs. Supabase clients (browser, server, middleware) are configured. Middleware handles session refresh and route protection. Root route shows a landing page. `.env.local.example` documents required env vars.
  </done>
</task>

<task type="auto">
  <name>Task 2: Database migration, type definitions, and config files</name>
  <files>
    supabase/migrations/001_initial_schema.sql
    src/types/database.ts
    src/types/wizard.ts
    src/types/benchmark.ts
    src/lib/config/models.ts
    src/lib/config/constants.ts
  </files>
  <action>
    **Create the database schema, TypeScript type definitions, and configuration files that define the application's data model.**

    1. **Create database migration** (`supabase/migrations/001_initial_schema.sql`):
       Use the EXACT schema from RESEARCH.md Pattern: Phase 1 Database Schema section. Includes:
       - `benchmark_drafts` table with separate JSONB columns for config_data, upload_data, schema_data
       - `reports` table with config_snapshot, share_token, status
       - RLS policies: owners can CRUD drafts, owners can read reports, anyone can read shared reports
       - Indexes on user_id, status, share_token, created_at

    2. **Create type definitions:**
       - `src/types/database.ts`: TypeScript types matching the DB schema (BenchmarkDraft, Report interfaces). Include Supabase Database type structure for typed queries.
       - `src/types/wizard.ts`: WizardConfig (priorities, strategy, sampleCount), WizardStep enum, Priority type (accuracy/speed/cost), Strategy type (quick-survey/deep-dive/balanced), ImageEntry type (path, publicUrl, expectedJson, jsonValid), SchemaConfig type.
       - `src/types/benchmark.ts`: Report type, BenchmarkConfig type, ModelInfo type matching the curated model list.

    3. **Create config files:**
       - `src/lib/config/models.ts`: Curated model lineup array with metadata per model: id (OpenRouter model ID), name (display name), provider, tier (premium/mid/budget), inputCostPer1k, outputCostPer1k, contextWindow, supportsVision: true. Include at least 20 models from the curated list. Add `PROVIDER_COLORS` and `TIER_COLORS` maps.
       - `src/lib/config/constants.ts`: MAX_IMAGES (10), MIN_IMAGES (1), MAX_FILE_SIZE_MB (10), ACCEPTED_IMAGE_TYPES, API_BUDGET_CEILING (7.00), REPORT_PRICE (14.99), DEFAULT_PRIORITIES, DEFAULT_STRATEGY, PRICES_AS_OF_DATE.

    **Anti-patterns to AVOID:**
    - Do NOT create a single JSONB column for all wizard state -- use separate columns per step to avoid race conditions
  </action>
  <verify>
    1. `npm run build` succeeds with no TypeScript errors
    2. TypeScript types in `src/types/` compile without errors
    3. `supabase/migrations/001_initial_schema.sql` exists and contains valid SQL
    4. `src/lib/config/models.ts` exports a model array with 20+ entries
  </verify>
  <done>
    Database migration creates benchmark_drafts and reports tables with RLS policies. Type definitions compile for all data models (wizard state, benchmark config, database schema). Config files define the curated model list (20+ models with pricing) and application constants.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes with zero errors
2. Dev server starts and root route (`/`) shows landing page
3. All Supabase client files (browser, server, middleware) exist and compile
4. Database migration SQL is valid and creates benchmark_drafts + reports tables with RLS
5. Type definitions compile for wizard, benchmark, and database types
6. Config files define 20+ curated models and application constants
</verification>

<success_criteria>
- Next.js 16 App Router project with TypeScript, Tailwind CSS v4, and dark-warm palette is fully set up
- All Supabase client helpers (browser, server, middleware) are implemented following official patterns
- Database migration covers benchmark_drafts and reports tables with proper RLS
- All Phase 1 type definitions and config files exist and compile
- Root route shows a landing page with sign-in CTA
</success_criteria>

<output>
After completion, create `.planning/phases/01-configure-benchmark/01-01-SUMMARY.md`
</output>
